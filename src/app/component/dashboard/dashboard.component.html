<div class="container-fluid">
  <div class="container">
    <div class="row mt-2 " style="height: 500px; margin-right:150px; ">
      <div class="col" ></div>
      <div class="col-md-9  shadow">
        <!-- Card for Title -->
        <div class=" mt-4">
          <h4 class="text ps-3 pt-20 pb-2" >ToDo List</h4>
        </div>

        <!-- Input group to add new task -->
        <div class="shadow">
          <div class="input-group p-4">
            <input type="text" class="form-control" placeholder="Enter task" [(ngModel)]="taskInput">
            <button class="btn btn-outline-success" type="button" (click)="addTache()">+</button>
          </div>
        </div>

        <!-- Display tasks -->
        <h4 class="text mt-4">Tasks:</h4>
        <div style="overflow-y: auto; height: 350px;">
          <div *ngFor="let task of taches" class="m-3">
            <div class="p-2 shadow border d-flex justify-content-between align-items-center">
              <!-- Task description (if not editing) -->
              <div class="col-md-9">
                  <!-- Checkbox to mark task as done and show subtasks -->
               <input type="checkbox" class="todo-checkbox" [(ngModel)]="task.completed">
                &nbsp;<span *ngIf="!task.isEditing">{{ task.title }}</span>
                 
                <div *ngIf="task.isEditing">
                  <input 
                    type="text" 
                    [(ngModel)]="task.title" 
                    class="form-control" 
                    placeholder="Update the task" 
                  />
                </div>
               

                <!-- Edit and Delete buttons -->
                &nbsp;&nbsp;<div class="btn-group">
                  <button class="btn btn-outline-primary btn-sm" (click)="editTask(task)">e</button>
                  <button class="btn btn-outline-danger btn-sm" (click)="deleteTask(task.id)">x</button>
                </div>
                <!-- List of subtasks (shown when task is marked as completed) -->
                <div *ngIf="task.completed && task.subtasks && task.subtasks.length > 0" class="subtasks-list mt-3">
                  <ul>
                    <li *ngFor="let subtask of task.subtasks">
                      {{ subtask.title }}
                    </li>
                  </ul>
                </div>
              </div>

              <!-- Buttons for task edit (validation or cancel) -->
              <div *ngIf="task.isEditing" class="task-edit-container mt-2">
                <button 
                  class="btn btn-success me-2" 
                  (click)="saveTask(task)" 
                  title="Save"
                >
                  ✔
                </button>
                <button 
                  class="btn btn-danger" 
                  (click)="deleteTask(task.id)" 
                  title="Cancel"
                >
                  ✖
                </button>
              </div>

              <!-- Button to add sub-task -->
              <button 
                class="btn btn-outline-primary mt-4 " 
                (click)="showSubTaskInput(task)">
                Add Sub-task
              </button>

              <!-- Input for new sub-task (visible when clicking 'Add Sub-task') -->
              <div *ngIf="task.showSubTaskInput" class="mt-3 ms-3" >
                <input 
                  type="text" 
                  [(ngModel)]="newSubTaskTitle" 
                  class="form-control mb-2" 
                  placeholder="Enter sub-task">
                <button 
                  class="btn btn-outline-primary me-2" 
                  (click)="addSubTask(task)">
                  Add
                </button>
              </div>
              
              

              
            </div>
          </div>
        </div>
      </div>
      <div class="col"></div>
    </div>
  </div>
</div>
